## Εργασία 3 - Φοιτητές: Χωραφάς Χρήστος(8718)/Φάββας Αντώνης(8675), Ομάδα 33

## <pre>Βήμα 1)</pre>  


<pre><b>Ερώτημα 1</b></pre>  <br>
 
  
<pre> 1.1 - Υπάρχουν ακεκτοί παράγοντες που επηρεάζουν την κατανάλωση ενέργειας από τον επεξεργαστή (CPU).
Οι πιο βασικοί από αυτούς είναι Α)Dynamic Power, B)Short-Cirquit Power, Γ)Leakage Power και συνδέονται 
με την σχέση (Pcpu = Pdyn + Psc + Pleak).

 Αναλυτικότερα το Dynamic Power προέρχεται από την δραστηριότητα των λογικών πυλών στο εσωτερικό της CPU. 
Όταν μια λογική πύλη μεταβαίνει από μία κατάσταση σε μία άλλη, υπάρχει ροή ενέργειας καθώς για να ολοκληρωθεί 
αυτή η μετάβαση, οι πυκνωτές φορτίζονται και εκφορτίζονται στο εσωτερικό της. Γενικά το Dynamic Power είναι 
ανάλογο με μία σειρά παραγόντων, όπως Α) Συνολική Χωρητικότητα των ηλεκτρονικών διατάξεων, Β) Παροχή 
ηλεκτρικού ρεύματος, Γ) Συχνότητα  του ρολογιού και Δ) Παράγοντα-Δραστηριότητας (Activity-Factor). Ο υπολογισμός 
της συνολικής χωρητικότητας, πραγματοποιείται μέσα από την αποσύνθεση του μοντέλου του επεξεργαστή σε μικρότερα
-και όπως είναι φυσικό- απλούστερα σύνολα κυκλωμάτων, των οποίων η χωρητικότητα είναι πιο εύκολο να υπολογισθεί
χρησιμοποιώντας αναλυτικά μοντέλα. Ακόμα σημαντικό είναι πως ο υπολογισμός του Παράγοντα-Δραστηριότητας, 
γίνεται χρησιμοποιώντας στατιστικά δεδομένα που σχετίζονται με τις απαιτήσεις πρόσβασης (Requests-Access)
του επεξεργαστή, δεδομένα τα οποία όπως είναι λογικό παράγονται από διάφορες προσομοιώσεις.

 Τα τρανζίστορς στις διάφορες ηλεκτρονικές διατάξεις του επεξεργαστή παρουσιάζουν μία ενεργειακή διαρροή 
(Leakage), καθώς αποβάλλουν συνεχώς static-power. To Leakage Power χωρίζεται σε δύο υποκατηγορίες Α) Subthreshold
Leakage το οποίο εμφανίζεται καθώς μία πολύ μικρή ποσότητα ρεύματος ρέει μέσα από το source και το drain του 
τρανζίστορ, ακόμα και όταν αυτό βρίσκεται σε κατάσταση απενεργοποίησης (off-state). Ωστόσο πρέπει να τονιστεί 
πως παρόλο που αυτό το ρεύμα είναι εξαιρετικά μικρό για κάθε τρανζίστορ, αν έχουμε για παράδειγμα εκατομμύρια ή 
δισεκατομμύρια τρανζίστορς (όπως συμβαίνει στην πραγματικότητα στο εσωτερικό των CPU) τότε το άθροισμα όλων αυτών 
των ρευμάτων διαρροής είναι εξαιρετικά σημαντικό. H δεύτερη υποκατηγορία Β) Gate Leakage προέρχεται από την διαρροή 
ενός μικρού ρεύματος από την πύλη (gate) του κάθε τρανζίστορ και διαφοροποιείται αρκετά ανάλογα με την κατάσταση 
της CPU. Επίσης πρέπει να πούμε πως η σημασία αυτών των μικρο-ρευμάτων διαρροής εξαρτάται άμεσα από την
κατάσταση, τις διαστάσεις, τις φυσικές ιδιότητες, ακόμα μερικές φορές και από την θερμοκρασία των τρανζίστορς.
Τέλος πολύ σημαντικό είναι το γεγονός πως η συνολική ποσότητα του Leakage Power φένεται να παρουσιάζει μεγάλες 
τιμές όταν ο παρουσιάζονται υψηλές θερμοκρασίες. Απαραίτητο ειναι να αναφερθεί πως και το Dynamic Power και το 
Short-Cirquit Power εξαρτώνται από την συχνότητα του ρολογιού του επεξεργαστή, ενώ το Leakage Power εξαρτάται από 
την παροχή ηλεκτρικού δυναμικού σε αυτόν. Μέσα από αρκετά πειράματα έχει αποδειχθεί ότι η κατανάλωση ενέργειας για 
κάθε επεξεργαστή ακολουθεί μία κυρτή καμπύλη, πράγμα το οποίο σημαίνει πως υπάρχει μία συχνότητα ρολογιού για την 
οποία ο επεξεργαστής παρουσιάζει ελάχιστη κατανάλωση ενέργειας.

 (Στο εργαστήριο ο κ. Παπαυεσταθίου μας ανέφερε πως το Leakage Power σχετίζεται άμεσα με την ενέργεια που 
καταναλώνεται στην CPU όταν αυτή βρίσκεται σε κατάσταση "stand-by".)
 
 1.2 - Αν τρέχαμε δύο διαφορετικά προγράμματα στον ίδιο επεξεργαστή, ο παράγοντας που θα παρουσίαζε διαφορά 
ανάμεσα στις δύο δοκιμές θα ήταν το Dynamic Power καθώς λογικά θα είχαμε διαφορετικό activity-factor ανάμεσα στα 
προγράμματα. Το πρόγραμμα που θα περιέχει περισσότερες εντολές, προσβάσεις στην μνήμη  και διαδικασίες ελέγχου 
πάνω σε branches, θα έχει λογικά και μεγαλύτερο activity-factor άρα και μεγαλύτερο Dynamic Power.

 1.3 - Η συνολική χρονική διάρκεια διεκπεραίωσης του προγράμματος, έχει σημασία στην συνολική κατανάλωση ενέργειας 
του επεξεργαστή, καθώς σχετίζεται άμεσα με το Dynamic Power.</pre>  
   
   <br><br> 
<pre><b>Ερώτημα 2</b></pre>  <br>
<pre> Στην αρχιτεκτονική υπολογιστών το "Energy-Efficiency" εκφράζεται ως  "Performance per Watt". Αναλυτικότερα 
ο όρος αυτός εκφράζει την υπολογιστική ικανότητα του επεξεργαστή (operations/sec ή Cycles Per Instruction) προς 
κάθε watt που καταναλώνεται απο αυτόν. Είναι σημαντικό να αναφέρουμε πως αυτός ο όρος αποτελεί παράγοντα κλειδί 
για την επιλογή κατάλληλου επεξεργαστή, μιας και σχετίζεται άμεσα με το κόστος λειτουργείας του σε μακροχρόνιο 
επίπεδο.
 
 Στο παραδειγμά που μας δίνεται, ο επεξεργαστής (1) έχει κατανάλωση 5 watt, ενώ ο επεξεργαστής (2) έχει 
κατανάλωσει 40 watt. O επεξεργαστής που θα προσδώσει στο σύστημα την μεγαλύτερη διάρκεια μπαταρίας είναι αυτός 
που θα παρουσιάζει και το μεγαλύτερο (Energy_Efficiency = Perfomance/watt). Όπως γίνεται εύκολα αντιληπτό, 
προκειμένου ο δέυτερος επεξεργαστής να έχει μεγαλύτερο Energy-Efficiency, θα πρέπει να είναι και οχτώ φορές πιο 
γρήγορος στην διεκπεραίωση εντολών(overall Perfomance) από τον πρώτο.
 
 Το McPAT μας δίνει μία αρκετά ικανοποιητική εικόνα σχετικά με τα watt που καταναλώνει ο επεξεργαστής, ωστόσο δεν 
μας δίνει πληροφορίες σχετικά με το Perfomance του. Για αυτό εκτός από τα αποτελέσματα του McPAT χρειαζόμαστε και 
τα αποτελέσματα από κάποιον προσομοιωτή (π.χ gem_5), καθώς εκεί υπάρχουν χρήσιμες πληροφορίες σχετικά με την 
υπολογιστική ικανότητα του επεξεργαστή. Συγκεκριμένα η παράμετρος που μας ενδιαφέρει είναι η
"CPI = CyclesPerInstrction".</pre>
 
 

    
   <br><br>
<pre><b>Ερώτημα 3</b></pre>  <br>  

<pre> Στο παραδειγμά αυτό συκρίνονται οι επεξεργαστές Xeon και ARM_A9 έχοντας ως υπόθεση οτι η 
υπολογιστική ικανότητα (Perfomance) του πρώτου είναι 40 φορές μεγαλύτερη από του δέυτερου. Υποθέτουμε 
ότι η υπολογιστική ικανότητα του ARM_A9 είναι x, σύμφωνα με τα δεδομένα της άσκησης και τον τύπο 
(Energy_Efficiency = Perfomance/watt) έχουμε: EEff(ARM_9)=x/2,86 => EEff(ARM_9) = 0.3496x ενώ 
EEff(Xeon) = 40x/72.91 => EEff(Xeon) = 0.5486x. Όπως είναι φανερό αν αυτά ήταν τα δεδομένα της άσκησης 
τότε ο Xeon επεξεργαστής θα ήταν πιο ενεργειακά αποδοτικός σε σχέση με τον ARM_A9, ωστόσο στην εκφώνηση 
αναφέρεται ρητά ότι μετά το πέρας του προγράμματος, το σύστημα δεν απενεργοποιείται, κάτι το οποίο ανατρέπει 
τα δεδομένα, καθώς μας υποχρεώνει να λάβουμε υπόψην τον παράγοντα "Total_Leakage" ο οποίος σχετίζεται με την 
ενέργεια που καταναλώνει ο επεξεργαστής όταν βρίσκεται σε κατάσταση "stand-by". Παρατηρώντας τα αποτελέσματα 
του McPAT, βλέπουμε πως ο Xeon έχει 360 φορές μεγαλύτερο Total_Leakage σε σχέση με τον ARM_A9 γεγονός που τον 
καθιστά εξαιρετικά λιγότερο ενεργειακά αποδοτικό στην συσγκεκριμένη περίπτωση.</pre>
     
<pre>  </pre>
   <br><br>  
     
## <pre>Bήμα 2)</pre>  

<pre><b>Ερώτημα 1</b></pre>  <br>

<pre> Την μέτρηση για το delay δεν μπορούμε να την πάρουμε κάπως από το McPAT. Μπορούμε να το βρούμε όμως στα 
αρχεία του gem5 και συγκεκριμένα στο stats.txt, όπου το delay ουσιαστικά είναι ο χρόνος sim_seconds. Από την 
άλλη, χρησιμοποιώντας την εντολή : 
                          print_energy.py mcpat_output_file gem5_stats_file
παίρνουμε το energy που καταναλώνεται στον επεξεργαστή για την διεκπεραίωση του προγράμματος.</pre>

<br><br>

<pre><b>Ερώτημα 2</b></pre>  <br>
<pre> Ήταν αδύνατο να τρέξουμε για όλα τα benchmarks, για αυτό τρέξαμε και πήραμε γραφήματα μόνο για το 401 για όλες
τις παραμέτρους και είδαμε την επίδρασή τους στο area και στο Peak Power (αθροιστικά των core και l2).</pre>


<br><br><br>


## Κριτική
Σαν εργασία ήταν πολύ ενδιαφέρουσα. Ασχοληθήκαμε με το πρόγραμμα McPAT και σε συνδυασμό με το gem5 πήραμε πληροφορίες για μετρήσεις που αφορούν π.χ. ισχύ, απώλεια αυτής και energy efficiency (χρησιμοποιώντας και το python script για μετατροπή σε ενέργεια). Ψάξαμε σε πολλές βιβλιογραφίες για τους όρους dynamic, leakage και short circuit power και ενισχύσαμε τις γνώσεις που αποκτήσαμε από τα μαθήματα της ηλεκτρονικής, καθώς εδώ είδαμε να εφαρμόζονται στην πράξη. Ήρθαμε σε επαφή με πιο πρακτικά πράγματα, κάτι που δεν μας το δίνουν πολλά μαθήματα στην σχολή, όπως για παράδειγμα οι συχνότητες και οι απώλειες ισχύος των επεξεργαστών και η ταχύτητα εκτέλεσης προγραμμάτων σε διαφορετικές αρχιτεκτονικές τους. Πειραματιστήκαμε με διάφορες αρχιτεκτονικές επεξεργαστών και συνειδητοποιήσαμε ότι δεν παίζει ρόλο μόνο η ταχύτητα εκτέλεσης, αλλά και οι απώλειες ισχύος (leakage). Συγκεκριμένα, υπάρχει δυνατότητα ένας επεξεργαστής να τρέχει πολύ πιο γρήγορα ένα πρόγραμμα, αλλα ταυτόχρονα να έχει πολύ μεγαλύτερο leakage από έναν άλλο, συνεπώς δεν μας συμφέρει. Αυτή την φορά δεν είχαμε στην έγνοια μας τους χρόνους που απαιτούνταν για την εκτέλεση των προσομοιώσεων (downside της προηγούμενης εργασίας), αφού η εργασία αυτή βασίζεται περισσότερο στην κατανόηση θερητικών αντικειμένων, πράγμα που μας χαλάρωσε λίγο. Βέβαια το πρόβλημα με το ανέβασμα των αρχείων στο github επιμένει, ειδικά τώρα που φτιάξαμε και περισσότερο φακέλους, τουλάχιστον όμως επεκτείναμε τις γνώσεις μας σχετικά  με την ωραιοποίηση του README! Εν ολίγοις ήταν μια ευχάριστη, "θεωρητική" εργασία, που πρόσφερε αρκετό ψάξιμο και γνώσεις χρήσιμες.

## Συμπερασματικά για όλες τις εργασίες και το εργαστήριο
'Ενα από τα καλύτερα εργαστήρια που έχουμε κάνει στην σχολή, αφού δεν έχουμε ξαναασχοληθεί με hardware και software, τουλάχιστον σε αυτό τον βαθμό, σε άλλα μαθήματα. Οι εργασίες περιείχαν σωστές οδηγίες για να κατεβάσουμε διάφορα dependencies και pre-requisites και κατανοητές ερωτήσεις, που εμφάνιζαν αυξανόμενο βαθμό δυσκολίας. Σαν ομάδα θεωρούμε το πιο δύσκολο που είχαμε να κάνουμε ήταν να "βρούμε" μια συνάρτηση κόστους για την 2η εργασία, καθώς χρειαζόταν και για την 3η. Τέλος, αξίζει να αναφέρουμε ότι τις φορές που κάτι δεν μας ήταν κατανοητό μέσα από τις βιβλιογραφίες που μας δίνονταν (που ήταν αρκετές), όποιες απορίες είχαμε και μπορούσαμε να ρωτήσουμε μας λύνονταν από τους καθηγητές. 

<br>

<b>_Βιβλιογραφία_<b>:  https://en.wikipedia.org/wiki/CPU_power_dissipation  
https://www.hpl.hp.com/research/mcpat/micro09.pdf  
https://www.sciencedirect.com/topics/computer-science/static-power  
https://en.wikipedia.org/wiki/CPU_cache  
https://cirosantilli.com/linux-kernel-module-cheat/?fbclid=IwAR3h1ny5hRoVUIGP1vtOsUAzqXYd69sHBAopwuveHZtTSbd_MFp0B4Nmp8c#gem5-cpu-types   
http://gem5.org/InOrder  
http://www.m5sim.org/SimpleCPU#BaseSimpleCPU  
http://www.gem5.org/docs/html/minor.html
